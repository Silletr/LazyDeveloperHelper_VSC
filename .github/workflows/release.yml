- name: Generate Changelog
  if: success()
  run: |
    VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo "")
    if [ -n "$VERSION" ]; then
      BODY="{"version": "$VERSION"}"
    else
      BODY='{"bump": "patch"}'
    fi
    SIGNATURE="sha256=$(echo -n "$BODY" | openssl dgst -sha256 -hmac "${{ secrets.AUTOCHANGELOG_SECRET }}" | cut -d' ' -f2)"
    curl -X POST "${{ secrets.AUTOCHANGELOG_WEBHOOK_URL }}" \
      -H "Content-Type: application/json" \
      -H "X-Webhook-Signature: $SIGNATURE" \
      -d "$BODY"
